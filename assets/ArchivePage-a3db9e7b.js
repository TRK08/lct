import{d as C,r as i,o as n,b as c,w as u,a as R,t as b,m as z,s as m,u as F,n as P,c as v,e as r,j as g,f as d,l as j,F as y,p as D}from"./index-c32ba48e.js";import{a as w,u as k,_ as L}from"./VideoPlayer.vue_vue_type_style_index_0_lang-de1d5b30.js";const M=C({__name:"ArchiveCard",props:{archiveItem:{}},setup(l){const t=l;return(o,h)=>{const _=i("n-card");return n(),c(_,{hoverable:"",style:{cursor:"pointer"}},{default:u(()=>[R("p",null,b(t.archiveItem.name),1)]),_:1})}}});const S=z("archive",{state:()=>({fetchStatus:"init",archive:[]}),actions:{async getArchive(){var l;try{const t=await w.get("https://89.232.165.248.sslip.io/api/v1/ml/list");if(t)return this.archive=t.data,this.archive}catch(t){if(this.fetchStatus="error",w.isAxiosError(t))return console.log(t),{status:this.fetchStatus,code:(l=t.response)==null?void 0:l.status}}finally{this.fetchStatus="init"}}}}),G=C({__name:"ArchivePage",setup(l){const{videoId:t,videoPath:o}=m(k()),{checkVideoStatus:h}=k(),{archive:_,fetchStatus:x}=m(S()),{getArchive:A}=S(),p=F(),V=async()=>{const s=await A();(s==null?void 0:s.status)==="error"&&p.error({content:"Не удалось загрузить архив",duration:3e3})},B=async s=>{const e=await h(s,!0);console.log(e,"RES"),(e==null?void 0:e.status)==="error"&&p.warning({content:"Видео еще не обработано",duration:3e3})};return P(()=>{V()}),(s,e)=>{const f=i("n-spin"),I=i("n-gi"),N=i("n-grid"),$=i("n-result"),E=i("n-modal");return n(),v(y,null,[r(x)==="loading"?(n(),c(f,{key:0,size:"large",style:{width:"100%"}})):g("",!0),r(_).length>0?(n(),c(N,{key:1,cols:"4","x-gap":"16","y-gap":"16"},{default:u(()=>[(n(!0),v(y,null,D(r(_),a=>(n(),c(I,{key:a.id},{default:u(()=>[d(M,{archiveItem:a,onClick:T=>B(a.id)},null,8,["archiveItem","onClick"])]),_:2},1024))),128))]),_:1})):g("",!0),d(E,{show:r(o),"onUpdate:show":e[0]||(e[0]=a=>j(o)?o.value=a:null),preset:"card",style:{width:"fit-content","min-width":"50vw"},onClose:e[1]||(e[1]=a=>o.value=null)},{default:u(()=>[r(o)?(n(),c(L,{key:0,path:r(o)},null,8,["path"])):(n(),c($,{key:1,status:"info",title:"Подождите, видео обрабатывается"},{footer:u(()=>[d(f,{size:"large"})]),_:1}))]),_:1},8,["show"])],64)}}});export{G as default};
