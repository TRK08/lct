import{d as I,m as z,r as i,o,b as c,w as u,a as v,t as g,n as D,s as y,u as F,p as L,c as w,e as r,j as S,f as h,l as P,F as k,q as j}from"./index-f9c5c501.js";import{a as C,u as x,_ as q}from"./VideoPlayer.vue_vue_type_style_index_0_lang-c7070b59.js";const M=I({__name:"ArchiveCard",props:{archiveItem:{}},setup(l){const t=l,n=z(()=>new Date(t.archiveItem.created).toLocaleString());return(p,d)=>{const _=i("n-card");return o(),c(_,{hoverable:"",style:{cursor:"pointer"}},{default:u(()=>[v("p",null,"Название файла"+g(t.archiveItem.name),1),v("small",null,"Дата: "+g(n.value),1)]),_:1})}}});const A=D("archive",{state:()=>({fetchStatus:"init",archive:[]}),actions:{async getArchive(){var l;try{const t=await C.get("https://89.232.165.248.sslip.io/api/v1/ml/list");if(t)return this.archive=t.data,this.archive}catch(t){if(this.fetchStatus="error",C.isAxiosError(t))return console.log(t),{status:this.fetchStatus,code:(l=t.response)==null?void 0:l.status}}finally{this.fetchStatus="init"}}}}),H=I({__name:"ArchivePage",setup(l){const{videoId:t,videoPath:n}=y(x()),{checkVideoStatus:p}=x(),{archive:d,fetchStatus:_}=y(A()),{getArchive:V}=A(),f=F(),B=async()=>{const s=await V();(s==null?void 0:s.status)==="error"&&f.error({content:"Не удалось загрузить архив",duration:3e3})},N=async s=>{const e=await p(s,!0);console.log(e,"RES"),(e==null?void 0:e.status)==="error"&&f.warning({content:"Видео еще не обработано",duration:3e3})};return L(()=>{B()}),(s,e)=>{const m=i("n-spin"),$=i("n-gi"),E=i("n-grid"),R=i("n-result"),b=i("n-modal");return o(),w(k,null,[r(_)==="loading"?(o(),c(m,{key:0,size:"large",style:{width:"100%"}})):S("",!0),r(d).length>0?(o(),c(E,{key:1,cols:"4","x-gap":"16","y-gap":"16"},{default:u(()=>[(o(!0),w(k,null,j(r(d),a=>(o(),c($,{key:a.id},{default:u(()=>[h(M,{archiveItem:a,onClick:T=>N(a.id)},null,8,["archiveItem","onClick"])]),_:2},1024))),128))]),_:1})):S("",!0),h(b,{show:r(n),"onUpdate:show":e[0]||(e[0]=a=>P(n)?n.value=a:null),preset:"card",style:{width:"fit-content","min-width":"50vw"},onClose:e[1]||(e[1]=a=>n.value=null)},{default:u(()=>[r(n)?(o(),c(q,{key:0,path:r(n)},null,8,["path"])):(o(),c(R,{key:1,status:"info",title:"Подождите, видео обрабатывается"},{footer:u(()=>[h(m,{size:"large"})]),_:1}))]),_:1},8,["show"])],64)}}});export{H as default};
